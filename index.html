<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© - Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</title>
<meta name="theme-color" content="#0b4d2e">
<style>
  :root{--green:#0b4d2e;--gold:#d4af37;--muted:#dfeee0}
  body{margin:0;font-family:Tahoma, Arial, sans-serif;background:linear-gradient(180deg,var(--green),#083a22);color:var(--muted);text-align:center}
  header{padding:16px;color:var(--gold);font-size:20px;font-weight:700}
  .card{background:rgba(255,255,255,0.03);margin:14px auto;padding:12px;border-radius:12px;max-width:900px}
  .center{display:flex;flex-direction:column;gap:8px;align-items:center}
  select,input{padding:10px;border-radius:8px;border:0;background:rgba(255,255,255,0.04);color:var(--muted);min-width:220px}
  button{padding:10px 14px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--gold),#ffd966);color:#063218;font-weight:700;cursor:pointer}
  .times{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:8px;margin-top:12px}
  .time{background:rgba(0,0,0,0.12);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03)}
  .overlay{position:fixed;inset:0;background:rgba(7,43,14,0.97);display:none;flex-direction:column;justify-content:center;align-items:center;color:var(--gold);z-index:9999}
  .overlay h1{font-size:2rem;margin:6px}
  .ad-box{width:100%;max-width:560px;margin-top:18px;padding:10px;background:#fff;color:#000;border-radius:8px;display:none}
  .small{font-size:13px;color:#bcd9c2}
  #clock{margin-top:12px;font-weight:700;font-size:16px;color:#ffd966}
  @media(max-width:520px){ header{font-size:18px} .ad-box{padding:8px} }
</style>
</head>
<body>
<header>ğŸ•Œ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© â€” Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</header>

<div class="card center" id="intro">
  <div class="small">Ø£ÙˆÙ„ Ù…Ø±Ø©ØŸ ÙØ¹Ù‘Ù„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ù„ØªØ¹Ù…Ù„ Ø§Ù„Ù…Ø²Ø§ÙŠØ§ Ø§Ù„ÙƒØ§Ù…Ù„Ø©</div>
  <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:8px">
    <button id="btnEnableAll">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø£ØµÙˆØ§Øª</button>
  </div>
  <div class="small">Ø¥Ø°Ø§ Ø±ÙØ¶ Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø³ÙŠØ¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª ÙŠØ¯ÙˆÙŠØ§Ù‹.</div>
</div>

<div class="card" id="main" style="display:none">
  <div class="center">
    <div id="status" class="small">Ø¬Ø§Ø±Ù Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª...</div>

    <div id="manualSelect" style="display:none;margin-top:8px">
      <label class="small">Ø§Ø®ØªØ± ÙˆÙ„Ø§ÙŠØªÙƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><br>
      <select id="wilayaSelect"></select>
    </div>

    <div class="times" id="timesBox" style="margin-top:12px"></div>
    <div id="nextBox" class="small" style="margin-top:12px"></div>
    <div id="clock">00:00:00</div>
  </div>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø£Ø°Ø§Ù† -->
<div class="overlay" id="adhanOverlay">
  <h1 id="adhanTitle">ğŸ“¢ Ø­Ø§Ù† ÙˆÙ‚Øª Ø§Ù„Ø£Ø°Ø§Ù†</h1>
  <div id="adhanCountdown" class="small" style="margin-top:8px"></div>
  <div class="ad-box" id="adBox">
    <!-- Ø¥Ø¹Ù„Ø§Ù† AdSense ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª -->
    <div id="adsPlaceholder">ğŸ”” Ø¥Ø¹Ù„Ø§Ù† (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†)</div>
  </div>
</div>

<!-- Ø¹Ù†ØµØ± Ø§Ù„ØµÙˆØª: Ø§Ø¬Ø¹Ù„ adhan.mp3 ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯ -->
<audio id="adhanAudio" src="adhan.mp3" preload="auto"></audio>

<script>
/* ---------- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ù…Ø¹ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª ---------- */
const wilayas = {
  "Ø£Ø¯Ø±Ø§Ø±": { lat:27.8717, lon:-0.2833 },
  "Ø§Ù„Ø´Ù„Ù": { lat:36.1653, lon:1.3345 },
  "Ø§Ù„Ø£ØºÙˆØ§Ø·": { lat:33.4810, lon:2.5230 },
  "Ø£Ù… Ø§Ù„Ø¨ÙˆØ§Ù‚ÙŠ": { lat:35.8775, lon:7.1139 },
  "Ø¨Ø§ØªÙ†Ø©": { lat:35.5556, lon:6.1744 },
  "Ø¨Ø¬Ø§ÙŠØ©": { lat:36.7509, lon:5.0567 },
  "Ø¨Ø³ÙƒØ±Ø©": { lat:34.8504, lon:5.7280 },
  "Ø¨Ø´Ø§Ø±": { lat:31.6167, lon:-2.2167 },
  "Ø§Ù„Ø¨Ù„ÙŠØ¯Ø©": { lat:36.5556, lon:2.8322 },
  "Ø§Ù„Ø¨ÙˆÙŠØ±Ø©": { lat:36.3725, lon:3.9003 },
  "ØªÙ…Ù†Ø±Ø§Ø³Øª": { lat:22.7869, lon:5.5228 },
  "ØªØ¨Ø³Ø©": { lat:35.4072, lon:8.1247 },
  "ØªÙ„Ù…Ø³Ø§Ù†": { lat:35.0042, lon:-1.3299 },
  "ØªÙŠØ§Ø±Øª": { lat:35.3675, lon:1.3069 },
  "ØªÙŠØ²ÙŠ ÙˆØ²Ùˆ": { lat:36.7167, lon:4.0500 },
  "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„Ø¹Ø§ØµÙ…Ø©": { lat:36.7538, lon:3.0588 },
  "Ø§Ù„Ø¬Ù„ÙØ©": { lat:34.6667, lon:3.2667 },
  "Ø¬ÙŠØ¬Ù„": { lat:36.8167, lon:5.7667 },
  "Ø³Ø·ÙŠÙ": { lat:36.1900, lon:5.4167 },
  "Ø³Ø¹ÙŠØ¯Ø©": { lat:34.8333, lon:0.1667 },
  "Ø³ÙƒÙŠÙƒØ¯Ø©": { lat:36.8667, lon:6.9000 },
  "Ø³ÙŠØ¯ÙŠ Ø¨Ù„Ø¹Ø¨Ø§Ø³": { lat:35.2000, lon:-0.6333 },
  "Ø¹Ù†Ø§Ø¨Ø©": { lat:36.9000, lon:7.7667 },
  "Ù‚Ø§Ù„Ù…Ø©": { lat:36.4667, lon:7.4333 },
  "Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©": { lat:36.3650, lon:6.6147 },
  "Ø§Ù„Ù…Ø¯ÙŠØ©": { lat:36.2667, lon:2.7500 },
  "Ù…Ø³ØªØºØ§Ù†Ù…": { lat:35.9333, lon:0.1000 },
  "Ø§Ù„Ù…Ø³ÙŠÙ„Ø©": { lat:35.7000, lon:4.5667 },
  "Ù…Ø¹Ø³ÙƒØ±": { lat:35.6167, lon:0.1500 },
  "ÙˆØ±Ù‚Ù„Ø©": { lat:32.3667, lon:5.3333 },
  "ÙˆÙ‡Ø±Ø§Ù†": { lat:35.6961, lon:-0.6333 },
  "Ø§Ù„Ø¨ÙŠØ¶": { lat:33.6833, lon:1.6167 },
  "Ø¥Ù„ÙŠØ²ÙŠ": { lat:26.3333, lon:8.4667 },
  "Ø¨Ø±Ø¬ Ø¨ÙˆØ¹Ø±ÙŠØ±ÙŠØ¬": { lat:36.0667, lon:4.7667 },
  "Ø¨ÙˆÙ…Ø±Ø¯Ø§Ø³": { lat:36.7667, lon:3.4833 },
  "Ø§Ù„Ø·Ø§Ø±Ù": { lat:36.7667, lon:8.3000 },
  "ØªÙ†Ø¯ÙˆÙ": { lat:27.6667, lon:-8.1333 },
  "ØªÙŠØ³Ù…Ø³ÙŠÙ„Øª": { lat:35.6075, lon:1.8106 },
  "Ø§Ù„ÙˆØ§Ø¯ÙŠ": { lat:33.1000, lon:6.8333 },
  "Ø®Ù†Ø´Ù„Ø©": { lat:35.4333, lon:7.1333 },
  "Ø³ÙˆÙ‚ Ø£Ù‡Ø±Ø§Ø³": { lat:36.2500, lon:7.9500 },
  "ØªÙŠØ¨Ø§Ø²Ø©": { lat:36.6000, lon:2.4500 },
  "Ù…ÙŠÙ„Ø©": { lat:36.4500, lon:6.1667 },
  "Ø¹ÙŠÙ† Ø§Ù„Ø¯ÙÙ„Ù‰": { lat:36.2500, lon:1.9833 },
  "Ø§Ù„Ù†Ø¹Ø§Ù…Ø©": { lat:33.2667, lon:-0.2667 },
  "Ø¹ÙŠÙ† ØªÙ…ÙˆØ´Ù†Øª": { lat:35.2969, lon:-1.1403 },
  "ØºØ±Ø¯Ø§ÙŠØ©": { lat:32.4900, lon:3.6700 },
  "ØºÙ„ÙŠØ²Ø§Ù†": { lat:35.0000, lon:-0.6667 },
  "ØªÙŠÙ…ÙŠÙ…ÙˆÙ†": { lat:29.2500, lon:0.2667 },
  "Ø¨Ø±Ø¬ Ø¨Ø§Ø¬ÙŠ Ù…Ø®ØªØ§Ø±": { lat:21.4167, lon:-0.9833 },
  "Ø£ÙˆÙ„Ø§Ø¯ Ø¬Ù„Ø§Ù„": { lat:34.2500, lon:1.8333 },
  "Ø¨Ù†ÙŠ Ø¹Ø¨Ø§Ø³": { lat:35.6000, lon:7.4500 },
  "Ø¥Ù† ØµØ§Ù„Ø­": { lat:28.5667, lon:8.1000 },
  "Ø¥Ù† Ù‚Ø²Ø§Ù…": { lat:27.1667, lon:5.1167 },
  "ØªÙ‚Ø±Øª": { lat:33.6167, lon:5.3667 },
  "Ø¬Ø§Ù†Øª": { lat:23.1667, lon:5.4167 },
  "Ø§Ù„Ù…ØºÙŠØ±": { lat:32.2667, lon:5.2333 },
  "Ø§Ù„Ù…Ù†ÙŠØ¹Ø©": { lat:32.8833, lon:0.5833 }
};

/* ---------- Ø¹Ù†Ø§ØµØ± DOM ---------- */
const btnEnableAll = document.getElementById('btnEnableAll');
const intro = document.getElementById('intro');
const main = document.getElementById('main');
const statusEl = document.getElementById('status');
const manualSelect = document.getElementById('manualSelect');
const wilayaSelect = document.getElementById('wilayaSelect');
const timesBox = document.getElementById('timesBox');
const nextBox = document.getElementById('nextBox');
const adhanAudio = document.getElementById('adhanAudio');
const adhanOverlay = document.getElementById('adhanOverlay');
const adBox = document.getElementById('adBox');
const adPlaceholder = document.getElementById('adsPlaceholder');
const clockEl = document.getElementById('clock');

let timings = null;
let scheduledTimers = [];

/* ---------- Ø§Ù…Ù„Ø£ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ---------- */
Object.keys(wilayas).forEach(w => {
  const opt = document.createElement('option');
  opt.value = w; opt.textContent = w;
  wilayaSelect.appendChild(opt);
});

/* ---------- Ø·Ù„Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ---------- */
async function requestAllPermissions() {
  try { await adhanAudio.play(); adhanAudio.pause(); } catch(e){console.warn(e);}
  if ('Notification' in window) { try { await Notification.requestPermission(); } catch(e){} }
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(pos => {
      const {latitude:lat,longitude:lon}=pos.coords;
      localStorage.setItem('lastLocation', JSON.stringify({lat,lon}));
      initWithLocation(lat, lon,'Ø­Ø³Ø¨ Ù…ÙˆÙ‚Ø¹Ùƒ');
    }, err => { manualSelect.style.display='block'; main.style.display='block'; intro.style.display='none'; statusEl.textContent='Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø±ÙÙˆØ¶ â€” Ø§Ø®ØªØ± ÙˆÙ„Ø§ÙŠØªÙƒ ÙŠØ¯ÙˆÙŠØ§Ù‹.'; }, {maximumAge:600000, timeout:8000});
  } else { statusEl.textContent='Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ â€” Ø§Ø®ØªØ± ÙˆÙ„Ø§ÙŠØªÙƒ ÙŠØ¯ÙˆÙŠØ§Ù‹.'; manualSelect.style.display='block'; main.style.display='block'; intro.style.display='none'; }
}

/* Ø­Ø¯Ø« Ø§Ù„Ø²Ø± */
btnEnableAll.addEventListener('click', () => requestAllPermissions());

/* Ø§Ø®ØªÙŠØ§Ø± ÙŠØ¯ÙˆÙŠ */
wilayaSelect.addEventListener('change', () => {
  const selected = wilayaSelect.value;
  if(wilayas[selected]) {
    const {lat, lon} = wilayas[selected];
    localStorage.setItem('selectedWilaya', selected);
    initWithLocation(lat, lon, selected);
  }
});

/* Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª */
async function initWithLocation(lat, lon, placeName='Ø­Ø³Ø¨ Ù…ÙˆÙ‚Ø¹Ùƒ') {
  try {
    statusEl.textContent = `ØªØ­Ù…ÙŠÙ„ Ù…ÙˆØ§Ù‚ÙŠØª ${placeName}...`;
    main.style.display = 'block'; intro.style.display='none';
    const timestamp = Math.floor(Date.now()/1000);
    const url = `https://api.aladhan.com/v1/timings/${timestamp}?latitude=${lat}&longitude=${lon}&method=2`;
    const res = await fetch(url);
    const json = await res.json();
    if(json && json.data && json.data.timings) {
      timings = json.data.timings;
      renderTimings(timings);
      scheduleAdhans(timings);
      statusEl.textContent = `Ø§Ù„ÙˆÙ„Ø§ÙŠØ©: ${placeName}`;
      localStorage.setItem('lastTimings', JSON.stringify({timings, placeName, lat, lon}));
    } else { throw new Error('no timings'); }
  } catch(e){
    console.warn(e);
    const cached = localStorage.getItem('lastTimings');
    if(cached) {
      const obj = JSON.parse(cached); timings=obj.timings; renderTimings(timings);
      statusEl.textContent=`Ø¹Ø±Ø¶ Ø¢Ø®Ø± Ù…ÙˆØ§Ù‚ÙŠØª Ù…Ø­ÙÙˆØ¸ (${obj.placeName}) â€” Ø§Ø¶ØºØ· ØªÙØ¹ÙŠÙ„ Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ø¥Ù†ØªØ±Ù†Øª.`;
    } else {
      statusEl.textContent='ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„ØªÙˆØ§Ù‚ÙŠØª â€” ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ© ÙŠØ¯ÙˆÙŠØ§Ù‹.';
      manualSelect.style.display='block'; main.style.display='block'; intro.style.display='none';
    }
  }
}

/* Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª */
function renderTimings(t) {
  timesBox.innerHTML=''; const order=['Fajr','Sunrise','Dhuhr','Asr','Maghrib','Isha'];
  const arab={Fajr:'Ø§Ù„ÙØ¬Ø±',Sunrise:'Ø§Ù„Ø´Ø±ÙˆÙ‚',Dhuhr:'Ø§Ù„Ø¸Ù‡Ø±',Asr:'Ø§Ù„Ø¹ØµØ±',Maghrib:'Ø§Ù„Ù…ØºØ±Ø¨',Isha:'Ø§Ù„Ø¹Ø´Ø§Ø¡'};
  order.forEach(k=>{
    const div=document.createElement('div'); div.className='time';
    div.innerHTML=`<strong>${arab[k]}</strong><div style="margin-top:6px;font-weight:700">${t[k]}</div>`;
    timesBox.appendChild(div);
  });
  updateNextPrayer(t);
}

/* Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© */
function updateNextPrayer(t){
  if(!t) return;
  const order=['Fajr','Dhuhr','Asr','Maghrib','Isha']; const now=new Date();
  let nextName=null,nextDate=null;
  for(let k of order){ const dt=parseTimeToDate(t[k],now); if(dt>now){nextName=k; nextDate=dt; break;} }
  if(!nextDate){ const tomorrow=new Date(); tomorrow.setDate(tomorrow.getDate()+1); nextDate=parseTimeToDate(t['Fajr'],tomorrow); nextName='Fajr'; }
  const diff=Math.max(0,Math.floor((nextDate-now)/1000));
  nextBox.textContent=`Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ${toArabicName(nextName)} â€” Ø¨Ø¹Ø¯ ${formatDuration(diff)}`;
}

/* ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø§Ø³Ù… Ù„Ù„Ø¹Ø±Ø¨ÙŠØ© */
function toArabicName(k){ return ({Fajr:'Ø§Ù„ÙØ¬Ø±',Dhuhr:'Ø§Ù„Ø¸Ù‡Ø±',Asr:'Ø§Ù„Ø¹ØµØ±',Maghrib:'Ø§Ù„Ù…ØºØ±Ø¨',Isha:'Ø§Ù„Ø¹Ø´Ø§Ø¡'})[k]||k; }
function parseTimeToDate(timeStr,baseDate){ const [hh,mm]=timeStr.split(':').map(n=>parseInt(n,10)); return new Date(baseDate.getFullYear(),baseDate.getMonth(),baseDate.getDate(),hh,mm,0,0);}
function formatDuration(sec){ const h=Math.floor(sec/3600),m=Math.floor((sec%3600)/60),s=sec%60; return `${h}Ø³Ø§ ${m}Ø¯ ${s}Ø«`; }

/* Ø§Ù„Ø£Ø°Ø§Ù† */
function clearScheduled(){ scheduledTimers.forEach(id=>clearTimeout(id)); scheduledTimers=[]; }
function scheduleAdhans(t){ clearScheduled(); if(!t) return; const keys=['Fajr','Dhuhr','Asr','Maghrib','Isha']; const now=new Date();
  keys.forEach(k=>{ let dt=parseTimeToDate(t[k],now); if(dt<=now) return; const ms=dt-now; const id=setTimeout(()=>{ triggerAdhan(k); }, ms); scheduledTimers.push(id); });
}
function triggerAdhan(k){
  adhanOverlay.style.display='flex';
  document.getElementById('adhanTitle').textContent=`ğŸ“¢ Ø­Ø§Ù† Ø§Ù„Ø¢Ù† ${toArabicName(k)}`;
  adBox.style.display=navigator.onLine?'block':'none';
  adhanAudio.currentTime=0; adhanAudio.play().catch(e=>console.warn(e));
  adhanAudio.onended=()=>{ adhanOverlay.style.display='none'; adhanAudio.onended=null; };
  setTimeout(()=>{ adhanOverlay.style.display='none'; },180000);
}

/* ØªØ§ÙŠÙ…Ø± Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø© */
function updateClock(){ const now=new Date(); clockEl.textContent=now.toLocaleTimeString('ar-EG'); }
setInterval(updateClock,1000); updateClock();

/* Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© */
window.addEventListener('load', async ()=>{
  const savedWilaya=localStorage.getItem('selectedWilaya'); if(savedWilaya) wilayaSelect.value=savedWilaya;
  const lastLoc=localStorage.getItem('lastLocation'); if(lastLoc){ const loc=JSON.parse(lastLoc); initWithLocation(loc.lat,loc.lon,'Ù…
